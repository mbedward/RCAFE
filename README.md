
<!-- README.md is generated from README.Rmd. Please edit that file -->

# RCAFE

<!-- badges: start -->
<!-- badges: end -->

An R package to (possibly) resurrect (some of) the CAFE (Cellular
Analysis of Fire and Extinction) simulation model that was used for a
series of studies by Ross Bradstock and colleagues in the 1990s,
investigating plant population dynamics in relation to various wildfire
regimes.

## Installation

You can install the development version of RCAFE from
[GitHub](https://github.com/) with:

``` r
# install.packages("devtools")
devtools::install_github("mbedward/RCAFE")
```

## Examples

``` r
library(RCAFE)
library(terra)
#> terra 1.7.78
```

``` r
library(progress)

# Create a matrix of random time since fire values (implicitly treated as years).
# The matrix dimensions will also define the simulation landscape.
sidelen <- 200
MinTSF <- 0
MaxTSF <- 10

tsf <- matrix(as.integer(sample(MinTSF:MaxTSF, size = sidelen*sidelen, replace = TRUE)), 
              sidelen, sidelen)

plot(rast(tsf))
```

<img src="man/figures/README-example-1.png" width="100%" />

``` r

# A function to relate the probability of fire in a cell to the
# time since fire
fn_prob <- function(tsf) {
  1 / (1 + exp(2.5 - 0.37*tsf))
}

curve(fn_prob(x), from = 0, to = 40, ylim = c(0, 1), 
      xlab = "Time since fire", ylab = "Probability of cell ignition")
```

<img src="man/figures/README-example-2.png" width="100%" />

``` r


# Simulate fires for an intial period to evolve spatial structure in the 
# pattern of time since fire
Nburn_in <- 400
pb <- progress_bar$new(total = Nburn_in)

for (i in 1:Nburn_in) {
  pb$tick()

  res <- RCAFE:::doFire(tsf, fn_prob)

  # Update the TSF matrix based on the fire map returned by
  # the doFire function
  tsf <- tsf + 1
  tsf[res$landscape > 0] <- 0  # Burnt cells
}
#> 
#> [>----------------------------------------------------------------------]
#> 1%[>----------------------------------------------------------------------]
#> 2%[=>---------------------------------------------------------------------]
#> 2%[=>---------------------------------------------------------------------]
#> 3%[=>---------------------------------------------------------------------]
#> 4%[==>--------------------------------------------------------------------]
#> 4%[==>--------------------------------------------------------------------]
#> 5%[===>-------------------------------------------------------------------]
#> 5%[===>-------------------------------------------------------------------]
#> 6%[====>------------------------------------------------------------------]
#> 6%[====>------------------------------------------------------------------]
#> 7%[====>------------------------------------------------------------------]
#> 8%[=====>-----------------------------------------------------------------]
#> 8%[=====>-----------------------------------------------------------------]
#> 9%[======>----------------------------------------------------------------]
#> 9%[======>----------------------------------------------------------------]
#> 10%[=======>---------------------------------------------------------------]
#> 11%[=======>---------------------------------------------------------------]
#> 12%[========>--------------------------------------------------------------]
#> 12%[========>--------------------------------------------------------------]
#> 13%[=========>-------------------------------------------------------------]
#> 14%[=========>-------------------------------------------------------------]
#> 15%[==========>------------------------------------------------------------]
#> 15%[==========>------------------------------------------------------------]
#> 16%[===========>-----------------------------------------------------------]
#> 16%[===========>-----------------------------------------------------------]
#> 17%[===========>-----------------------------------------------------------]
#> 18%[============>----------------------------------------------------------]
#> 18%[============>----------------------------------------------------------]
#> 19%[=============>---------------------------------------------------------]
#> 19%[=============>---------------------------------------------------------]
#> 20%[==============>--------------------------------------------------------]
#> 20%[==============>--------------------------------------------------------]
#> 21%[==============>--------------------------------------------------------]
#> 22%[===============>-------------------------------------------------------]
#> 22%[===============>-------------------------------------------------------]
#> 23%[================>------------------------------------------------------]
#> 23%[================>------------------------------------------------------]
#> 24%[=================>-----------------------------------------------------]
#> 25%[=================>-----------------------------------------------------]
#> 26%[==================>----------------------------------------------------]
#> 26%[==================>----------------------------------------------------]
#> 27%[===================>---------------------------------------------------]
#> 28%[===================>---------------------------------------------------]
#> 29%[====================>--------------------------------------------------]
#> 29%[====================>--------------------------------------------------]
#> 30%[=====================>-------------------------------------------------]
#> 30%[=====================>-------------------------------------------------]
#> 31%[=====================>-------------------------------------------------]
#> 32%[======================>------------------------------------------------]
#> 32%[======================>------------------------------------------------]
#> 33%[=======================>-----------------------------------------------]
#> 33%[=======================>-----------------------------------------------]
#> 34%[========================>----------------------------------------------]
#> 35%[========================>----------------------------------------------]
#> 36%[=========================>---------------------------------------------]
#> 36%[=========================>---------------------------------------------]
#> 37%[==========================>--------------------------------------------]
#> 38%[===========================>-------------------------------------------]
#> 39%[===========================>-------------------------------------------]
#> 40%[============================>------------------------------------------]
#> 40%[============================>------------------------------------------]
#> 41%[============================>------------------------------------------]
#> 42%[=============================>-----------------------------------------]
#> 42%[=============================>-----------------------------------------]
#> 43%[==============================>----------------------------------------]
#> 43%[==============================>----------------------------------------]
#> 44%[===============================>---------------------------------------]
#> 44%[===============================>---------------------------------------]
#> 45%[===============================>---------------------------------------]
#> 46%[================================>--------------------------------------]
#> 46%[================================>--------------------------------------]
#> 47%[=================================>-------------------------------------]
#> 47%[=================================>-------------------------------------]
#> 48%[==================================>------------------------------------]
#> 49%[==================================>------------------------------------]
#> 50%[===================================>-----------------------------------]
#> 50%[===================================>-----------------------------------]
#> 51%[====================================>----------------------------------]
#> 52%[====================================>----------------------------------]
#> 53%[=====================================>---------------------------------]
#> 53%[=====================================>---------------------------------]
#> 54%[======================================>--------------------------------]
#> 54%[======================================>--------------------------------]
#> 55%[======================================>--------------------------------]
#> 56%[=======================================>-------------------------------]
#> 56%[=======================================>-------------------------------]
#> 57%[========================================>------------------------------]
#> 57%[========================================>------------------------------]
#> 58%[=========================================>-----------------------------]
#> 58%[=========================================>-----------------------------]
#> 59%[=========================================>-----------------------------]
#> 60%[==========================================>----------------------------]
#> 60%[==========================================>----------------------------]
#> 61%[===========================================>---------------------------]
#> 62%[============================================>--------------------------]
#> 63%[============================================>--------------------------]
#> 64%[=============================================>-------------------------]
#> 64%[=============================================>-------------------------]
#> 65%[==============================================>------------------------]
#> 66%[==============================================>------------------------]
#> 67%[===============================================>-----------------------]
#> 67%[===============================================>-----------------------]
#> 68%[================================================>----------------------]
#> 68%[================================================>----------------------]
#> 69%[================================================>----------------------]
#> 70%[=================================================>---------------------]
#> 70%[=================================================>---------------------]
#> 71%[==================================================>--------------------]
#> 71%[==================================================>--------------------]
#> 72%[===================================================>-------------------]
#> 73%[===================================================>-------------------]
#> 74%[====================================================>------------------]
#> 74%[====================================================>------------------]
#> 75%[=====================================================>-----------------]
#> 76%[=====================================================>-----------------]
#> 77%[======================================================>----------------]
#> 77%[======================================================>----------------]
#> 78%[=======================================================>---------------]
#> 78%[=======================================================>---------------]
#> 79%[=======================================================>---------------]
#> 80%[========================================================>--------------]
#> 80%[========================================================>--------------]
#> 81%[=========================================================>-------------]
#> 81%[=========================================================>-------------]
#> 82%[==========================================================>------------]
#> 82%[==========================================================>------------]
#> 83%[==========================================================>------------]
#> 84%[===========================================================>-----------]
#> 84%[===========================================================>-----------]
#> 85%[============================================================>----------]
#> 85%[============================================================>----------]
#> 86%[=============================================================>---------]
#> 87%[=============================================================>---------]
#> 88%[==============================================================>--------]
#> 88%[==============================================================>--------]
#> 89%[===============================================================>-------]
#> 90%[===============================================================>-------]
#> 91%[================================================================>------]
#> 91%[================================================================>------]
#> 92%[=================================================================>-----]
#> 92%[=================================================================>-----]
#> 93%[=================================================================>-----]
#> 94%[==================================================================>----]
#> 94%[==================================================================>----]
#> 95%[===================================================================>---]
#> 95%[===================================================================>---]
#> 96%[====================================================================>--]
#> 96%[====================================================================>--]
#> 97%[====================================================================>--]
#> 98%[=====================================================================>-]
#> 98%[=====================================================================>-]
#> 99%[======================================================================>]
#> 100%[=======================================================================]
#> 100%
```

``` r

# View the resulting TSF pattern
plot(rast(tsf))
```

<img src="man/figures/README-example-3.png" width="100%" />

``` r

# Simulate a few more fires and plot them to get some idea of
# the general patterns. We will only plot fires that burnt at least
# 5% of the landscape.
min_landscape_prop <- 0.05

rr <- lapply(1:16, function(...) {
  tsfx <- tsf
  while (TRUE) {
    res <- RCAFE:::doFire(tsf = tsfx, fn_prob)

    tsfx <- tsfx + 1
    tsfx[res$landscape > 0] <- 0

    if (res$ncells > sidelen*sidelen*min_landscape_prop) break
  }
  rast(res$landscape)
})

rr <- rast(rr)
plot(rr, legend = FALSE, main = "")
```

<img src="man/figures/README-example-4.png" width="100%" />

``` r


# Run the simulation function for a set of 100 year batches and view the
# time since fire pattern at the end of each batch
rr <- lapply(1:16, function(i) {
  tsf <<- RCAFE:::cafeSim(initial_tsf = tsf, n_times = 100, fn_prob_tsf = fn_prob)
  rast(tsf)
})

rr <- rast(rr)
names(rr) <- sprintf("%d years", seq_len(16) * 100)
plot(rr)
```

<img src="man/figures/README-example-5.png" width="100%" />
